/*basic modules************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
import React, { useState, useEffect } from 'react'

/*redux************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
import { connect } from 'react-redux'
import actions from '../../redux/actions/index.js'
import getBaseInfo from '../../helpers/getBaseInfo.js'

/*contaienrs************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
import Header from '../../Containers/Header/index.js'
import SubHeader from '../../Containers/SubHeader/index.js'
import Footer from '../../Containers/Footer/index.js'
import ProductPage from '../../Containers/ProductPage/index.js'

/*components************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
import Layout from '../../Components/Layout/index.js'

/*main function************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
function Products(props) {

    if (typeof window !== 'undefined') {

        /*var's************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
        var
            GET_SUB_HEADERS,
            GET_PRODUCT_BY_REFERENCE,
            PROPS_KEYS = Object.keys(props).length

        /*state************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
        var [InitialInnerWidth, setInitialInnerWidth] = useState(window.innerWidth)




        /*hooks************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
        useEffect(() => { props.verifyAuthentication() }, [])




        /*auto invoked functions************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
        for (let i = 0; i < PROPS_KEYS; i++) {
            if (props[i] !== null && props[i] !== undefined) {

                if (props[i].type === 'GET_SUB_HEADERS') {
                    GET_SUB_HEADERS = props[i]
                }

                if (props[i].type === 'GET_PRODUCT_BY_REFERENCE') {
                    GET_PRODUCT_BY_REFERENCE = props[i]
                }

            }
        }




        /*return desktop************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
        if (window.innerWidth > 720) {

            return (
                <Layout>

                    <Header
                        InitialInnerWidth={InitialInnerWidth}
                        setInitialInnerWidth={setInitialInnerWidth}
                        Desktop={true}
                        Mobile={false}
                        Default={true} />

                    <SubHeader
                        informations={GET_SUB_HEADERS.payload}
                        Desktop={true}
                        Mobile={false} />

                    <ProductPage
                        informations={GET_PRODUCT_BY_REFERENCE.payload} />

                    <Footer />

                </Layout>
            )
        }


        /*return mobbile************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
        if (window.innerWidth <= 720) {

            return (
                <Layout>

                    <Header
                        InitialInnerWidth={InitialInnerWidth}
                        setInitialInnerWidth={setInitialInnerWidth}
                        Desktop={false}
                        Mobile={true}
                        Default={true} />

                    <ProductPage
                        informations={GET_PRODUCT_BY_REFERENCE.payload} />

                    <Footer />

                </Layout>
            )
        }

    } else {
        return (
            <></>
        )
    }

}

Products.getInitialProps = async ctx => {

    return getBaseInfo([
        actions.getSubHeaders,
        actions.getProductByReference.bind(null, ctx.query.products)
    ], ctx)

}

const mapStateToProps = (state, ownProps) => ({
    ...state, ownProps
})
export default connect(mapStateToProps, actions)(Products)